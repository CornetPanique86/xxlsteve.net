const settings={isHD:!1,merge3DLayer:!1,outline:0},layer2DPos=[[{ori:[8,8,8,8],dest:[40,8]},{ori:[20,20,8,12],dest:[20,36]},{ori:[4,20,4,12],dest:[4,36]},{ori:[20,52,4,12],dest:[4,52]},{ori:[44,20,4,12],dest:[44,36]},{ori:[36,52,4,12],dest:[52,52]}],[{ori:[16,16,16,16],dest:[80,16]},{ori:[40,40,16,24],dest:[40,72]},{ori:[8,40,8,24],dest:[8,72]},{ori:[40,104,8,24],dest:[8,104]},{ori:[88,40,8,24],dest:[88,72]},{ori:[72,104,8,24],dest:[104,104]}]];let skinName="skin",baseSkin,canvas,skinViewer;function cardboardify(){if(!baseSkin)return;const t=settings.isHD?layer2DPos[1]:layer2DPos[0],e=canvas.getContext("2d",{willReadFrequently:!0});if(e.clearRect(0,0,canvas.width,canvas.height),e.drawImage(baseSkin,0,0),settings.merge3DLayer)for(const n of t){const s=e.getImageData(n.dest[0],n.dest[1],n.ori[2],n.ori[3]),o=e.getImageData(n.ori[0],n.ori[1],n.ori[2],n.ori[3]);for(let e=0;e<n.ori[3];e++)for(let i=0;i<n.ori[2];i++){const t=(e*n.ori[3]+i)*4;s.data[t+3]>0&&(o.data[t]=s.data[t],o.data[t+1]=s.data[t+1],o.data[t+2]=s.data[t+2],o.data[t+3]=s.data[t+3])}e.putImageData(o,n.ori[0],n.ori[1])}const s=[];for(const n of t)s.push(e.getImageData(n.ori[0],n.ori[1],n.ori[2],n.ori[3]));e.clearRect(0,0,canvas.width,canvas.height);for(let n=0;n<t.length;n++)e.putImageData(s[n],t[n].dest[0],t[n].dest[1]);const n=new Image;settings.isHD?n.src="/images/cardboard_template.png":settings.outline===0?n.src="/images/cardboard_template_java_black.png":n.src="/images/cardboard_template_java_white.png",n.onload=function(){e.drawImage(n,0,0),updateSkinViewer()}}function updateSkinViewer(){skinViewer.loadSkin(canvas.toDataURL("image/png"))}function downloadSkin(){const e=document.createElement("a");e.download=skinName+"_cardboardified.png",e.href=canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),e.click()}window.addEventListener("load",()=>{canvas=document.getElementById("preview2DSectionCanvas"),document.getElementById("uploadFile__fileBtn").addEventListener("change",e=>{if(!e.target.files[0])return;const t=e.target.files[0],n=new FileReader;n.onload=e=>{const t=new Image;t.onload=function(){const e={width:this.width,height:this.height};if(e.width===64&&e.height===64)updateHD(!1),baseSkin=t,cardboardify();else if(e.width===128&&e.height===128)updateHD(!0),baseSkin=t,cardboardify();else{customAlert("Incorrect image resolution! It can either be 64x64 or 128x128","#cc0000");return}},t.src=e.target.result},n.readAsDataURL(t),document.getElementById("uploadFile__chosenFile").textContent=t.name,skinName=t.name.replace(".png","")}),document.getElementById("searchUsername__btn").addEventListener("click",()=>{checkJavaUsername()}),document.getElementById("searchUsername__input").addEventListener("keyup",e=>{e.key==="Enter"&&checkJavaUsername()}),document.getElementById("merge3DLayer").addEventListener("click",()=>{document.getElementById("merge3DLayer").checked?(settings.merge3DLayer=!0,cardboardify()):(settings.merge3DLayer=!1,cardboardify())}),document.getElementById("skinIsHD").addEventListener("click",()=>!1),document.getElementById("outlineBtn").addEventListener("click",()=>{document.getElementById("outlineBtn").checked?(settings.outline=1,cardboardify()):(settings.outline=0,cardboardify())}),document.getElementById("iconScaleRange").addEventListener("input",e=>{changeIconScale(e.target.value)}),canvas.addEventListener("wheel",changeIconScaleWheel,{passive:!1}),document.getElementById("downloadBtn").addEventListener("click",()=>{downloadSkin()}),skinViewer=new skinview3d.SkinViewer({canvas:document.getElementById("skin_container"),width:200,height:350,skin:"/images/steve_skin.png",zoom:.6});const e=new Image;e.onload=function(){const t={width:this.width,height:this.height};t.width===64&&t.height===64&&(updateHD(!1),baseSkin=e,cardboardify())},e.src="/images/steve_skin.png"});function checkJavaUsername(){const e=document.getElementById("searchUsername__input").value;if(e.length==0)return;if(e.length>16){customAlert("Must be a Java username under 16 characters long!","#cc0000");return}const t=new Image;t.onload=function(){this.width===64&&this.height===64&&(updateHD(!1),baseSkin=t,cardboardify())},t.src="https://mineskin.eu/skin/"+e,t.crossOrigin="Anonymous",skinName=e}function updateHD(e){e?(settings.isHD=!0,document.getElementById("skinIsHD").removeAttribute("checked"),document.getElementById("outlineBtn").style.display="none",document.querySelector("label[for=outlineBtn]").style.display="none",canvas.width=128,canvas.height=128):(settings.isHD=!1,document.getElementById("skinIsHD").setAttribute("checked","true"),document.getElementById("outlineBtn").style.display="inline",document.querySelector("label[for=outlineBtn]").style.display="inline-block",canvas.width=64,canvas.height=64)}let scale=1;function changeIconScaleWheel(e){e.preventDefault(),e.deltaY>=0?scale-=.1:scale+=.1,scale=Math.min(Math.max(1,scale),8),canvas.style.transform=`scale(${scale}) translate(-20%, -10%)`,document.getElementById("iconScaleRangeLabel").innerHTML="Scale: "+scale.toString().substring(0,3),document.getElementById("iconScaleRange").value=scale}function changeIconScale(e){canvas.style.transform=`scale(${e}) translate(-20%, -10%)`,document.getElementById("iconScaleRangeLabel").innerHTML="Scale: "+e}